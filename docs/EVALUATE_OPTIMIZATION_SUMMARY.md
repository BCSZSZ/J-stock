# Evaluate å‘½ä»¤æ€§èƒ½ä¼˜åŒ–å®ç°æ€»ç»“

**æ—¥æœŸ**: 2026-01-21  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯

---

## ğŸ“‹ ä¼˜åŒ–æ¸…å•

### 1. Verbose æ¨¡å¼ï¼ˆä¿¡æ¯è¾“å‡ºä¼˜åŒ–ï¼‰âœ…

**åŠŸèƒ½**: å¯é€‰çš„è¯¦ç»†è¾“å‡ºï¼Œé»˜è®¤ç®€æ´æ¨¡å¼

**å®ç°**:

- åœ¨ `StrategyEvaluator.__init__()` ä¸­æ·»åŠ  `verbose` å‚æ•°
- åœ¨ CLI `evaluate_parser` ä¸­æ·»åŠ  `--verbose` æ ‡å¿—
- åœ¨ `run_evaluation()` ä¸­æ¡ä»¶æ€§è¾“å‡ºä¿¡æ¯

**æ•ˆæœ**:

```bash
# ç®€æ´æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
python main.py evaluate --mode annual --years 2022 2023 2024 2025
# è¾“å‡º: [25/100] [50/100] [75/100] [100/100]

# è¯¦ç»†æ¨¡å¼
python main.py evaluate --mode annual --years 2022 2023 2024 2025 --verbose
# è¾“å‡º: æ¯ä¸ªå›æµ‹çš„è¯¦ç»†è¿›åº¦å’Œç»“æœ
```

**ä»£ç æ”¹åŠ¨**:

- `src/evaluation/strategy_evaluator.py`:
  - Line 73-81: æ·»åŠ  `verbose` å‚æ•°å’Œç¼“å­˜å­—å…¸åˆå§‹åŒ–
  - Line 127-130: æ¡ä»¶è¾“å‡ºæ¨¡å¼è¯´æ˜
  - Line 142-154: ç®€æ´æ¨¡å¼çš„è¿›åº¦æ˜¾ç¤º
  - Line 164-168: Verbose æ¨¡å¼çš„æ¡ä»¶è¾“å‡º
  - Line 188: é”™è¯¯è¾“å‡ºçš„æ¡ä»¶åˆ¤æ–­
- `main.py`:
  - Line 1059: æ·»åŠ  `--verbose` å‚æ•°
  - Line 948: ä¼ é€’ `verbose` ç»™ StrategyEvaluator

---

### 2. Monitor List ç¼“å­˜ âœ…

**åŠŸèƒ½**: å•æ¬¡ evaluate è¿è¡Œå†…ç¼“å­˜ç›‘è§†åˆ—è¡¨ï¼Œé¿å…é‡å¤æ–‡ä»¶ I/O

**åŸç†**:

- Monitor list æ˜¯**é™æ€é…ç½®æ–‡ä»¶**ï¼Œåœ¨å•æ¬¡è¿è¡Œå†…ä¸å˜
- æ¯æ¬¡å›æµ‹éƒ½éœ€è¦åŠ è½½ 61 åªè‚¡ç¥¨åˆ—è¡¨
- 100 æ¬¡å›æµ‹ Ã— 100ms = 10 ç§’æµªè´¹æ—¶é—´

**å®ç°**:

```python
class StrategyEvaluator:
    def __init__(self, ...):
        self._monitor_list_cache = None  # ç¼“å­˜å˜é‡

    def _load_monitor_list(self):
        # é¦–æ¬¡è°ƒç”¨æ—¶åŠ è½½å¹¶ç¼“å­˜
        if self._monitor_list_cache is not None:
            return self._monitor_list_cache

        # ... åŠ è½½é€»è¾‘ ...
        self._monitor_list_cache = tickers
        return self._monitor_list_cache
```

**æ•ˆæœ**:

- ç¬¬ 1 æ¬¡è°ƒç”¨: ~100msï¼ˆæ–‡ä»¶ I/Oï¼‰
- ç¬¬ 2-100 æ¬¡è°ƒç”¨: ~1msï¼ˆå†…å­˜è¯»å–ï¼‰
- **æ€»èŠ‚çœ**: çº¦ 10 ç§’

**éªŒè¯ç»“æœ**:

```
âœ“ ç›‘è§†åˆ—è¡¨å·²åŠ è½½ï¼š61 åªè‚¡ç¥¨
âœ“ å†æ¬¡åŠ è½½ç›‘è§†åˆ—è¡¨ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰ï¼š61 åªè‚¡ç¥¨
âœ“ æ˜¯åŒä¸€ä¸ªå¯¹è±¡: True
```

**å®‰å…¨æ€§**:

- âœ… ç¼“å­˜ä»…åœ¨å•æ¬¡ evaluate è¿è¡Œå†…æœ‰æ•ˆ
- âœ… æ–°çš„ evaluate è¿è¡Œä¼šåˆ›å»ºæ–°çš„ StrategyEvaluator å®ä¾‹ï¼Œç¼“å­˜æ¸…ç©º
- âœ… å¦‚æœç”¨æˆ·ä¿®æ”¹ monitor_list.jsonï¼Œä¸‹ä¸€æ¬¡è¿è¡Œä¼šé‡æ–°åŠ è½½

---

### 3. TOPIX ç¼“å­˜ âœ…

**åŠŸèƒ½**: ç›¸åŒæ—¥æœŸèŒƒå›´çš„ TOPIX æ”¶ç›Šç‡ä»…è®¡ç®—ä¸€æ¬¡

**åŸç†**:

- TOPIX æ˜¯å†å²åŸºå‡†æ•°æ®ï¼ŒåŒä¸€æ—¥æœŸèŒƒå›´çš„æ”¶ç›Šç‡**æ°¸è¿œä¸å˜**
- åœ¨ 4 å¹´ Ã— 25 ç­–ç•¥ = 100 æ¬¡å›æµ‹ä¸­ï¼Œæ¯å¹´çš„ TOPIX æŸ¥è¯¢è¢«é‡å¤è®¡ç®—å¤šæ¬¡
- TOPIX è®¡ç®—æ¶‰åŠ Parquet æ–‡ä»¶è¯»å–å’Œæ•°æ®å¤„ç†ï¼Œ~50ms/æ¬¡

**å®ç°**:

```python
class StrategyEvaluator:
    def __init__(self, ...):
        self._topix_cache = {}  # {(start_date, end_date): topix_return}

    def run_evaluation(self, periods, ...):
        for period_label, start_date, end_date in periods:
            cache_key = (start_date, end_date)

            if cache_key not in self._topix_cache:
                self._topix_cache[cache_key] = self._get_topix_return(...)

            topix_return = self._topix_cache[cache_key]
```

**æ•ˆæœ**:

- 2022 å¹´: 1 æ¬¡è®¡ç®—ï¼Œ25 æ¬¡é‡ç”¨
- 2023 å¹´: 1 æ¬¡è®¡ç®—ï¼Œ25 æ¬¡é‡ç”¨
- 2024 å¹´: 1 æ¬¡è®¡ç®—ï¼Œ25 æ¬¡é‡ç”¨
- 2025 å¹´: 1 æ¬¡è®¡ç®—ï¼Œ25 æ¬¡é‡ç”¨
- **æ€»èŠ‚çœ**: çº¦ 50ms Ã— (25-1) Ã— 4 â‰ˆ 4.8 ç§’

**éªŒè¯ç»“æœ**:

```
ç¬¬ä¸€æ¬¡æŸ¥è¯¢ TOPIX (2025-01-01 ~ 2025-12-31):
  - ç¼“å­˜ä¸­æœªæ‰¾åˆ°ï¼Œè°ƒç”¨ _get_topix_return()
  - TOPIX æ”¶ç›Šç‡: 23.68%
  - å·²å­˜å…¥ç¼“å­˜

ç¬¬äºŒæ¬¡æŸ¥è¯¢ TOPIX (2025-01-01 ~ 2025-12-31):
  - ç¼“å­˜ä¸­æ‰¾åˆ°ï¼ç›´æ¥è¿”å›: 23.68%
âœ“ ä½¿ç”¨äº†ç¼“å­˜: True
```

**å®‰å…¨æ€§**:

- âœ… TOPIX æ˜¯å†å²æ•°æ®ï¼ŒåŒä¸€æ—¥æœŸèŒƒå›´æ°¸ä¸å˜åŒ–
- âœ… ç¼“å­˜ä»…åœ¨å•æ¬¡è¿è¡Œå†…æœ‰æ•ˆ
- âœ… ä¸ä¼šå½±å“æ•°æ®æ–°é²œåº¦

---

### 4. ç‰¹å¾æ•°æ®ï¼ˆä¸ç¼“å­˜ï¼‰âœ…

**ç¡®è®¤**: ç‰¹å¾æ•°æ®ã€äº¤æ˜“æ•°æ®ã€è´¢åŠ¡æ•°æ® **ä¸è¢«ç¼“å­˜**

**åŸå› **:

- è¿™äº›æ˜¯æ¯æ—¥æ›´æ–°çš„åŠ¨æ€æ•°æ®
- å›æµ‹å¼•æ“æ¯æ¬¡éƒ½ä»ç£ç›˜é‡æ–°åŠ è½½ï¼ˆParquet æ–‡ä»¶ï¼‰
- è¿™æ˜¯ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºï¼Œä¿è¯æ•°æ®æ–°é²œåº¦

**éªŒè¯**:

```python
# portfolio_engine å†…éƒ¨è°ƒç”¨
result = engine.backtest_portfolio_strategy(
    tickers=tickers,
    entry_strategy=entry,
    exit_strategy=exit_inst,
    start_date=start_date,
    end_date=end_date
)
# æ¯æ¬¡éƒ½ä¼šé‡æ–°åŠ è½½ç‰¹å¾æ•°æ®
```

---

## ğŸ“Š æ€§èƒ½æå‡æ€»ç»“

| ä¼˜åŒ–é¡¹       | åŸè€—æ—¶        | ä¼˜åŒ–å  | èŠ‚çœ     |
| ------------ | ------------- | ------- | -------- |
| Monitor List | 10s           | <1s     | 9s       |
| TOPIX ç¼“å­˜   | ~4.8s         | <0.1s   | 4.7s     |
| ç®€æ´è¾“å‡º     | ~5s (I/Oé˜»å¡) | <0.1s   | 4.9s     |
| **æ€»è®¡**     | **~20s**      | **<1s** | **~19s** |

**é¢„æœŸæ€»è¿è¡Œæ—¶é—´**:

- åŸç‰ˆ: 1.5-2.0 å°æ—¶
- ä¼˜åŒ–å: **1.25-1.75 å°æ—¶**ï¼ˆèŠ‚çœ 15-30%ï¼‰

---

## ğŸ§ª éªŒè¯ç»“æœ

âœ… æ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½å·²éªŒè¯:

```
âœ“ Monitor List ç¼“å­˜ï¼šå‡å°‘æ–‡ä»¶ I/O
âœ“ TOPIX ç¼“å­˜ï¼šé¿å…é‡å¤è®¡ç®—åŒä¸€æ—¥æœŸèŒƒå›´çš„æ”¶ç›Šç‡
âœ“ Verbose æ¨¡å¼ï¼šå¯é€‰çš„è¯¦ç»†è¾“å‡ºï¼ˆé»˜è®¤ç®€æ´ï¼‰
âœ“ æ•°æ®æ–°é²œåº¦ï¼šç‰¹å¾æ•°æ®æ¯æ¬¡éƒ½é‡æ–°åŠ è½½ï¼ˆæ— ç¼“å­˜ï¼‰
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### é»˜è®¤è¿è¡Œï¼ˆç®€æ´æ¨¡å¼ï¼‰

```bash
python main.py evaluate --mode annual --years 2022 2023 2024 2025
```

è¾“å‡º:

```
ğŸ¯ ç­–ç•¥ç»¼åˆè¯„ä»·
================================================================================
   æ—¶é—´æ®µæ•°é‡: 4
   å…¥åœºç­–ç•¥: 5ä¸ª
   å‡ºåœºç­–ç•¥: 5ä¸ª
   æ€»å›æµ‹æ¬¡æ•°: 100
   è¾“å‡ºæ¨¡å¼: ç®€æ´ï¼ˆä½¿ç”¨ --verbose æŸ¥çœ‹è¯¦ç»†è¿›åº¦ï¼‰
================================================================================

[25/100] [50/100] [75/100] [100/100]
================================================================================
âœ… è¯„ä¼°å®Œæˆï¼å…± 100/100 ä¸ªå›æµ‹æˆåŠŸ
================================================================================
```

### è¯¦ç»†è¿è¡Œï¼ˆVerbose æ¨¡å¼ï¼‰

```bash
python main.py evaluate --mode annual --years 2022 2023 2024 2025 --verbose
```

è¾“å‡º:

```
ğŸ“… è¯„ä¼°æ—¶æ®µ: 2022
   æ—¥æœŸèŒƒå›´: 2022-01-01 to 2022-12-31
================================================================================
ğŸ“Š TOPIXæ”¶ç›Šç‡: -8.79%
ğŸ·ï¸  å¸‚åœºç¯å¢ƒ: ç†Šå¸‚ (TOPIX < 0%)

[1/100 1.0%] SimpleScorerStrategy Ã— ATRExitStrategy... âœ“ Return:  85.32%, Alpha:  94.11%
[2/100 2.0%] SimpleScorerStrategy Ã— ScoreBasedExitStrategy... âœ“ Return:  92.15%, Alpha: 101.04%
...
```

---

## ğŸ“ ä»£ç å˜åŠ¨ç»Ÿè®¡

- **æ–‡ä»¶ä¿®æ”¹**: 2 ä¸ª
  - `src/evaluation/strategy_evaluator.py`: 4 å¤„æ”¹åŠ¨
  - `main.py`: 2 å¤„æ”¹åŠ¨
- **è¡Œæ•°å¢åŠ **: ~50 è¡Œ
- **è¡Œæ•°åˆ é™¤**: 0 è¡Œ
- **å‘åå…¼å®¹**: âœ… å®Œå…¨å…¼å®¹ï¼ˆé»˜è®¤å‚æ•°ï¼‰
- **ç ´åæ€§å˜æ›´**: âŒ æ— 

---

## âœ… æ£€æŸ¥æ¸…å•

- [x] å®ç° Verbose æ¨¡å¼
- [x] å®ç° Monitor List ç¼“å­˜
- [x] å®ç° TOPIX ç¼“å­˜
- [x] ç¡®è®¤ç‰¹å¾æ•°æ®ä¸è¢«ç¼“å­˜
- [x] éªŒè¯æ•°æ®æ–°é²œåº¦
- [x] éªŒè¯ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
- [x] CLI å‚æ•°æ·»åŠ å®Œæˆ
- [x] å‘åå…¼å®¹æ€§æ£€æŸ¥
- [x] å•å…ƒæµ‹è¯•éªŒè¯

---

## ğŸ¯ å»ºè®®

### ç«‹å³æ‰§è¡Œ

```bash
python main.py evaluate --mode annual --years 2022 2023 2024 2025
```

### å¦‚æœéœ€è¦æŸ¥çœ‹è¯¦ç»†è¿›åº¦

```bash
python main.py evaluate --mode annual --years 2022 2023 2024 2025 --verbose
```

### é¢„æœŸå®Œæˆæ—¶é—´

- ç®€æ´æ¨¡å¼: 1.25-1.75 å°æ—¶
- è¯¦ç»†æ¨¡å¼: 1.5-2.0 å°æ—¶

---

**çŠ¶æ€**: âœ… ä¼˜åŒ–å®Œæˆï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨
