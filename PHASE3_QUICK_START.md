# 🎯 Phase 3 快速参考卡

## 一句话总结
围绕最优参数 D18_B20 进行微调，使用 **3^4 = 81个策略**，通过 **4 workers并行**执行 **405个回测**（5年），预计 **35-40分钟** 完成。

---

## 参数微调空间

```
中心参数 (D18_B20_N9_R3p5_T1p6):
  D = 18 (固定)
  B = 20.0 → [19.5, 20.0, 20.5]  (±0.5)
  N = 9 → [8, 9, 10]              (±1)
  R = 3.5 → [3.4, 3.5, 3.6]      (±0.1)
  T = 1.6 → [1.5, 1.6, 1.7]      (±0.1)

组合: 3 × 3 × 3 × 3 = 81
```

---

## 快速启动

```powershell
# 进入项目目录
cd e:\Code\AI-stock\J-stock

# 执行脚本 (推荐方案A)
.\execute_fine_grid.ps1

# 或使用Python (方案B)
python tools/run_fine_grid.py
```

---

## 文件清单

| 文件 | 作用 |
|------|------|
| `execute_fine_grid.ps1` | 🚀 立即执行 |
| `PHASE3_FINE_GRID_GUIDE.md` | 📖 详细指南 |
| `tools/generate_fine_grid.py` | ⚙️ 参数生成器 |
| `src/analysis/strategies/exit/multiview_grid_exit.py` | 🔧 已更新支持81个策略 |

---

## 预期时间表

| 阶段 | 耗时 | 备注 |
|------|------|------|
| 初始化 | 1-2分钟 | 加载数据、配置策略 |
| Phase 1-2 (90个测试) | 15分钟 | 并行执行 |
| Phase 3 (315个测试) | 20-25分钟 | 🎯 当前 |
| 结果汇总 | 2分钟 | CSV生成、报告输出 |
| **总计** | **35-40分钟** | |

---

## 预期输出

执行完成时，Google Drive会新增：

1. **strategy_evaluation_raw_[时间].csv**
   - 405行 × 14列完整数据
   - 所有参数-性能对应关系

2. **strategy_evaluation_by_regime_[时间].csv**
   - 按市场环境(熊/温/强)汇总
   - 81个策略 × 3环境 = 243行

3. **strategy_evaluation_report_[时间].md**
   - 自动生成的分析报告
   - 排名、统计、建议

---

## 成功标志

✅ PowerShell窗口输出:
```
✅ 评估完成！共 405/405 个回测成功
💾 原始结果已保存: G:\My Drive\...
✅ 市场环境分析已保存: G:\My Drive\...
✅ 报告已保存: G:\My Drive\...
```

---

## 常见问题

**Q1: 为什么选择这些步长?**
- B: 0.5 (±25%, 三点)
- N: 1.0 (MACD标准步长)
- R: 0.1 (0.5倍数, 精细)
- T: 0.1 (同R)

**Q2: 会不会过拟合?**
- Phase1/2 已验证 145个测试
- Phase3 添加 405个，总共 550个测试
- 虽然有风险，但跨越5年历史，置信度足够

**Q3: 新冠军能提升多少?**
- 预期: 35.30% → 35.5-37.0% (+0.2-1.7%)
- 或改善2023年强牛市表现
- 不确定，需回测验证

**Q4: 执行过程中能中断吗?**
- 不推荐。但可以Ctrl+C终止
- 已执行的数据不会丢失（存在cache）
- 重新执行会跳过已完成的

---

## 后续分析流程

1. **等待执行完成** (35-40分钟)
2. **下载三个CSV文件** 到本地
3. **生成Phase3结果报告**
4. **对比Phase1/2/3排名**
5. **确定最终推荐策略**

---

*准备完毕，祝回测顺利！* 🚀
