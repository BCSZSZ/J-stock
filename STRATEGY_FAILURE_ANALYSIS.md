# 9ä¸ªç­–ç•¥ç»„åˆå¤±è´¥åˆ†æä¸æ”¹è¿›æ–¹å‘

## ğŸ“Š å›æµ‹æ€»è§ˆï¼ˆ2021-01-01 è‡³ 2026-01-08ï¼Œä¸°ç”°7203ï¼‰

| ç­–ç•¥ç»„åˆ | æ€»å›æŠ¥ | å¤æ™®æ¯”ç‡ | èƒœç‡ | äº¤æ˜“æ¬¡æ•° | vs TOPIX |
|---------|--------|---------|------|---------|---------|
| **EnhancedScorer + ScoreBasedExit** | +42.69% | 0.00 | 100% | 1 | -44.13% |
| **MACDCrossover + ScoreBasedExit** | +22.39% | 0.98 | 40% | 20 | -64.43% |
| **EnhancedScorer + LayeredExit** | +20.82% | **4.15** | 45.5% | 11 | -66.00% |
| **EnhancedScorer + ATRExitStrategy** | +19.92% | 3.10 | 42.9% | 7 | -66.90% |
| SimpleScorer + ScoreBasedExit | +16.77% | 1.82 | 25% | 4 | -70.04% |
| MACDCrossover + ATRExitStrategy | +11.01% | 1.18 | 41.4% | 29 | -75.80% |
| MACDCrossover + LayeredExit | +8.62% | 1.09 | 37.5% | 32 | -78.19% |
| SimpleScorer + LayeredExit | -4.33% | 0.44 | 33.3% | 15 | -91.14% |
| SimpleScorer + ATRExitStrategy | -1.21% | -0.72 | 30% | 10 | -88.02% |

**åŸºå‡†æ¯”è¾ƒï¼šTOPIX +86.82%**

---

## ğŸ” æ ¸å¿ƒé—®é¢˜è¯Šæ–­

### é—®é¢˜1ï¼šæ‰€æœ‰ç­–ç•¥éƒ½å¤§å¹…è·‘è¾“TOPIXï¼ˆAlphaå…¨éƒ¨ä¸ºè´Ÿï¼‰

**ç°è±¡ï¼š**
- æœ€å¥½ç­–ç•¥ï¼ˆEnhancedScorer + ScoreBasedExitï¼‰ï¼š+42.69% vs TOPIX +86.82% = **-44.13% Alpha**
- æœ€å·®ç­–ç•¥ï¼ˆSimpleScorer + LayeredExitï¼‰ï¼š-4.33% vs TOPIX +86.82% = **-91.14% Alpha**

**æ ¹æœ¬åŸå› åˆ†æï¼š**

#### 1. **é€‰è‚¡é—®é¢˜ > ç­–ç•¥é—®é¢˜**
- TOPIXåœ¨5å¹´å†…æ¶¨äº†86%ï¼Œè¯´æ˜æ—¥æœ¬è‚¡å¸‚æ•´ä½“å¼ºåŠ¿ï¼ˆå—ç›Šäºå¼±æ—¥å…ƒã€å¤–èµ„æµå…¥ï¼‰
- æˆ‘ä»¬é€‰çš„ä¸°ç”°7203åªæ˜¯ä¸­ç­‰è¡¨ç°
- **å…³é”®æ´å¯Ÿï¼šå³ä½¿æœ€å¥½çš„æ‹©æ—¶ç­–ç•¥ï¼Œä¹Ÿæ— æ³•å¼¥è¡¥é€‰é”™è‚¡ç¥¨**

#### 2. **ç°é‡‘æ‹–ç´¯æ•ˆåº”**
- é¢‘ç¹äº¤æ˜“ç­–ç•¥ï¼ˆMACDç»„åˆï¼Œ29-32æ¬¡äº¤æ˜“ï¼‰å¹³å‡æŒä»“ç‡ < 70%
- 30%ç°é‡‘ä»“ä½ Ã— 5å¹´ Ã— TOPIXå¹´åŒ–+13.5% = æŸå¤±çº¦20%æ”¶ç›Š
- **Buy & Hold TOPIXçš„Beta > æˆ‘ä»¬çš„ç­–ç•¥å‚ä¸åº¦**

#### 3. **äº¤æ˜“æˆæœ¬æœªè®¡å…¥**
- æ—¥æœ¬è‚¡å¸‚äº¤æ˜“æˆæœ¬ï¼š
  - åˆ¸å•†ä½£é‡‘ï¼š0.1-0.3%ï¼ˆä¹°+å– = 0.2-0.6%ï¼‰
  - ä»·å·®æ»‘ç‚¹ï¼š0.05-0.2%
  - å°èŠ±ç¨ï¼šæ— ï¼ˆæ—¥æœ¬2021å¹´åå–æ¶ˆï¼‰
  - **æ¯æ¬¡äº¤æ˜“å®é™…æˆæœ¬ â‰ˆ 0.25-0.8%**
- MACD + LayeredExitï¼ˆ32æ¬¡äº¤æ˜“ï¼‰æ€»æˆæœ¬ â‰ˆ **8-25.6%**
- **è¿™è¿˜æœªè®¡å…¥**ï¼Œå®é™…å›æŠ¥ä¼šæ›´å·®

---

### é—®é¢˜2ï¼šä¹°å…¥ä¿¡å·è´¨é‡ä¸é«˜

#### SimpleScorerç»„åˆï¼ˆæœ€å·®3ä¸ªéƒ½åœ¨è¿™ï¼‰

**äº¤æ˜“æ¡ˆä¾‹åˆ†æï¼š**
```
ä¹°å…¥ï¼š2025-03-25 @ Â¥2,916ï¼ˆScore 66ï¼‰
å–å‡ºï¼š2025-03-31 @ Â¥2,630.5ï¼ˆ-9.79%ï¼‰- ä»…æŒæœ‰6å¤©å°±æ­¢æŸ
```

**é—®é¢˜è¯Šæ–­ï¼š**
1. **åˆ†æ•°65-68å¾˜å¾Šåœ¨é˜ˆå€¼é™„è¿‘ = ä¿¡å·å¼±**
   - åˆšè¾¾åˆ°65å°±ä¹°ï¼Œå¾ˆå¯èƒ½æ˜¯å‡çªç ´
   - éœ€è¦æ›´é«˜ç¡®è®¤ï¼ˆå¦‚68+æŒç»­3å¤©ï¼‰

2. **ç¼ºå°‘è¶‹åŠ¿ç¡®è®¤**
   - SimpleScoreræ²¡æœ‰å®è§‚ç¯å¢ƒè¿‡æ»¤
   - 2025å¹´3æœˆå¯èƒ½å¤§ç›˜å°±åœ¨ä¸‹è·Œ

3. **èµ„é‡‘æµå‘çŸ›ç›¾**
   - Score 66å¯èƒ½æ¥è‡ªï¼šæŠ€æœ¯50 + æœºæ„15 + åŸºæœ¬é¢10
   - å³ä½¿æ€»åˆ†è¾¾æ ‡ï¼Œä½†æœºæ„èµ„é‡‘è¿˜åœ¨æµå‡ºï¼ˆleading indicatorï¼‰

#### MACD Crossoverç»„åˆï¼ˆäº¤æ˜“é¢‘ç¹ï¼Œèƒœç‡ä½ï¼‰

**å…¸å‹å¤±è´¥æ¡ˆä¾‹ï¼š**
```
2022-02-10 ä¹°å…¥ @ Â¥2,301ï¼ˆMACDé‡‘å‰ï¼‰
2022-02-14 å–å‡º @ Â¥2,174ï¼ˆ-5.52%ï¼‰- 4å¤©åå°±æ­¢æŸ
```

**é—®é¢˜è¯Šæ–­ï¼š**
1. **MACDæ»åæ€§**
   - é‡‘å‰æ—¶è¶‹åŠ¿å¯èƒ½å·²ç»ç»“æŸ
   - åœ¨éœ‡è¡å¸‚é¢‘ç¹whipsaw

2. **æ²¡æœ‰åŸºæœ¬é¢è¿‡æ»¤**
   - 2022å¹´2æœˆæ­£å€¼ä¿„ä¹Œæˆ˜äº‰å¼€å§‹ï¼Œå…¨çƒè‚¡å¸‚æš´è·Œ
   - çº¯æŠ€æœ¯æŒ‡æ ‡æ— æ³•è¯†åˆ«ç³»ç»Ÿæ€§é£é™©

3. **é«˜é¢‘äº¤æ˜“å¢åŠ æˆæœ¬**
   - 29-32æ¬¡äº¤æ˜“ï¼Œå¹³å‡æŒæœ‰17-22å¤©
   - æ¯æ¬¡éƒ½åƒäº¤æ˜“æˆæœ¬ï¼Œå¤åˆ©æŸå¤±å·¨å¤§

---

### é—®é¢˜3ï¼šå–å‡ºç­–ç•¥è¿‡äºæ•æ„Ÿæˆ–è¿‡äºè¿Ÿé’

#### ATRExitStrategy - è¿‡äºæ•æ„Ÿï¼ˆ30%èƒœç‡ï¼‰

**å¤±è´¥æ¡ˆä¾‹ï¼š**
```
ä¹°å…¥ï¼š2024-07-05 @ Â¥3,384ï¼ˆScore 66ï¼‰
å–å‡ºï¼š2024-07-18 @ Â¥3,151ï¼ˆ-6.89%ï¼‰- P0_HardStop
ä»…æŒæœ‰13å¤©ï¼Œå¯èƒ½æ˜¯æ­£å¸¸å›è°ƒï¼Œä¸æ˜¯è¶‹åŠ¿åè½¬
```

**é—®é¢˜ï¼š**
- ATR Hard Stopè§¦å‘å¤ªå¿«
- æ²¡æœ‰åŒºåˆ†"æ­£å¸¸å›è°ƒ"vs"è¶‹åŠ¿åè½¬"
- åº”è¯¥ç»“åˆå®è§‚ä¿¡å·ï¼ˆå¦‚å¤–èµ„æµå‘ï¼‰

#### ScoreBasedExit - è¿‡äºè¿Ÿé’ï¼ˆæˆ–è¿æ°”å¥½ï¼‰

**EnhancedScorer + ScoreBasedExitå”¯ä¸€èµ¢å®¶ï¼š**
```
ä¹°å…¥ï¼š2023-08-14 @ Â¥2,439.5ï¼ˆScore 65.75ï¼‰
å–å‡ºï¼š2024-06-18 @ Â¥3,068ï¼ˆ+25.76%ï¼‰- æŒæœ‰309å¤©ï¼
```

**ä¸ºä»€ä¹ˆèµ¢ï¼š**
- èµ¶ä¸Š2023ä¸‹åŠå¹´ - 2024ä¸ŠåŠå¹´æ—¥æœ¬è‚¡å¸‚å¤§ç‰›å¸‚
- åˆ†æ•°ä¸€ç›´ç»´æŒåœ¨65ä»¥ä¸Šï¼Œæ²¡æœ‰è§¦å‘é€€å‡º
- **ä½†è¿™æ˜¯è¢«åŠ¨æŒæœ‰ï¼Œä¸æ˜¯ä¸»åŠ¨ç­–ç•¥ä¼˜åŠ¿**

**éšè—é£é™©ï¼š**
- åªæœ‰1ç¬”äº¤æ˜“ï¼ŒSharpe Ratio = 0.00ï¼ˆæ— æ„ä¹‰ï¼‰
- å¦‚æœé‡åˆ°2022å¹´ç†Šå¸‚ï¼Œä¼šä¸€è·¯æŒæœ‰äºæŸ

#### LayeredExit - å¤æ‚ä½†ä¸æ™ºèƒ½

**é—®é¢˜æ¡ˆä¾‹ï¼š**
```
ä¹°å…¥ï¼š2025-12-05 @ Â¥3,053ï¼ˆScore 68ï¼‰
å–å‡ºï¼š2025-12-08 @ Â¥3,050ï¼ˆ-0.10%ï¼‰- Layer1_Emergency
æŒæœ‰ä»…3å¤©ï¼Œå› ä¸ºæ£€æµ‹åˆ°"å¤–èµ„æµå‡º"ç´§æ€¥å–å‡º
```

**é—®é¢˜ï¼š**
1. **è¿‡åº¦ååº”çŸ­æœŸæ•°æ®**
   - 3å¤©çš„å¤–èµ„æ•°æ®å¯èƒ½æ˜¯å™ªéŸ³
   - éœ€è¦ç¡®è®¤çª—å£ï¼ˆå¦‚è¿ç»­2å‘¨æµå‡ºï¼‰

2. **å±‚çº§ä¼˜å…ˆçº§æ··ä¹±**
   - Emergencyå±‚åº”è¯¥æ˜¯"ç³»ç»Ÿæ€§é£é™©"ï¼Œä¸æ˜¯"3å¤©å¤–èµ„æ³¢åŠ¨"
   - Layer5 Trailing Stopå¤ªé¢‘ç¹è§¦å‘ï¼ˆ15ç¬”äº¤æ˜“ä¸­10ç¬”ï¼‰

---

## ğŸ¯ æ ¸å¿ƒè¾“å› æ€»ç»“

### 1. **æŒä»“ä¸è¶³å¯¼è‡´ç‰›å¸‚è¸ç©º**
- TOPIX 5å¹´+86%ï¼Œä½†æˆ‘ä»¬ç­–ç•¥å¹³å‡æŒä»“ç‡60-80%
- **æ”¹è¿›ï¼šæé«˜ä»“ä½åˆ©ç”¨ç‡ OR å¢åŠ ä»“ä½ç®¡ç†ï¼ˆå¦‚é‡‘å­—å¡”åŠ ä»“ï¼‰**

### 2. **æ‹©æ—¶èƒ½åŠ›ä¸è¶³ï¼Œä¸å¦‚ä¹°å…¥æŒæœ‰**
- æœ€å¥½çš„Sharpe 4.15ï¼ˆEnhancedScorer + LayeredExitï¼‰ä¹Ÿåªè·‘èµ¢20%
- **æ”¹è¿›ï¼šä¸è¦è¯•å›¾å®Œç¾æ‹©æ—¶ï¼Œè€Œæ˜¯"é«˜æ¦‚ç‡åŒºé—´é‡ä»“ï¼Œä½æ¦‚ç‡åŒºé—´è½»ä»“"**

### 3. **ä¹°å…¥ä¿¡å·è´¨é‡å·®**
- SimpleScorerèƒœç‡ä»…25-33%
- MACDèƒœç‡37-41%
- **æ”¹è¿›ï¼šæé«˜ä¹°å…¥é˜ˆå€¼ + å¢åŠ ç¡®è®¤æ¡ä»¶**

### 4. **å–å‡ºä¿¡å·æ··ä¹±**
- ATRå¤ªæ•æ„Ÿï¼ˆé¢‘ç¹æ­¢æŸ-5%ï¼‰
- ScoreBasedExitå¤ªè¿Ÿé’ï¼ˆæŒæœ‰309å¤©çº¯é è¿æ°”ï¼‰
- LayeredExitè¿‡åº¦å¤æ‚ï¼ˆè§¦å‘æ¡ä»¶å¤ªå¤šï¼‰
- **æ”¹è¿›ï¼šç®€åŒ–é€»è¾‘ï¼Œèšç„¦æ ¸å¿ƒé€€å‡ºç†ç”±**

### 5. **æ²¡æœ‰å®è§‚é£é™©ç®¡ç†**
- 2022å¹´ç†Šå¸‚ï¼ˆä¿„ä¹Œæˆ˜äº‰ï¼‰å…¨äº
- æ²¡æœ‰è¯†åˆ«ç³»ç»Ÿæ€§é£é™©çš„èƒ½åŠ›
- **æ”¹è¿›ï¼šå¢åŠ å¸‚åœºç¯å¢ƒè¿‡æ»¤å™¨**

---

## ğŸ’¡ æ”¹è¿›æ–¹å‘å»ºè®®ï¼ˆåŸºäºç°æœ‰æƒ…æŠ¥ï¼‰

### æ–¹å‘1ï¼šæå‡ä¹°å…¥è´¨é‡ï¼ˆPriority: HIGHï¼‰

#### é—®é¢˜æ ¹æº
å½“å‰ä¹°å…¥é˜ˆå€¼ï¼ˆScore â‰¥ 65ï¼‰å¤ªä½ï¼Œå¯¼è‡´ï¼š
- å‡çªç ´é¢‘ç¹ï¼ˆåˆšåˆ°65å°±ä¹°ï¼Œç„¶åè·Œå›å»ï¼‰
- ä¿¡å·è´¨é‡å·®ï¼ˆ65å¯èƒ½æ˜¯æŠ€æœ¯45+æœºæ„10+åŸºæœ¬é¢10çš„å‹‰å¼ºç»„åˆï¼‰

#### æ”¹è¿›æ–¹æ¡ˆ
```python
# å½“å‰é€»è¾‘
if composite_score >= 65:
    return BUY

# æ”¹è¿›é€»è¾‘ - å¤šé‡ç¡®è®¤
def generate_entry_signal_v2(data, date):
    score = calculate_composite_score(data, date)
    
    # æ¡ä»¶1ï¼šåˆ†æ•°é˜ˆå€¼æé«˜
    if score < 70:  # ä»65æé«˜åˆ°70
        return HOLD
    
    # æ¡ä»¶2ï¼šè¶‹åŠ¿ç¡®è®¤ï¼ˆé¿å…é€†åŠ¿æŠ„åº•ï¼‰
    price = data.loc[date, 'close']
    ema200 = data.loc[date, 'ema_200']
    if price < ema200:  # ä»·æ ¼å¿…é¡»åœ¨200æ—¥å‡çº¿ä¸Šæ–¹
        return HOLD
    
    # æ¡ä»¶3ï¼šæœºæ„èµ„é‡‘ç¡®è®¤ï¼ˆæ ¸å¿ƒleading indicatorï¼‰
    inst_score = calculate_institutional_score(data, date)
    if inst_score < 60:  # æœºæ„åˆ†æ•°å¿…é¡»å¥åº·
        return HOLD
    
    # æ¡ä»¶4ï¼šåˆ†æ•°æŒç»­æ€§ï¼ˆé¿å…æ˜™èŠ±ä¸€ç°ï¼‰
    recent_scores = [calculate_composite_score(data, d) 
                     for d in last_3_days]
    if min(recent_scores) < 68:  # è¿‘3å¤©åˆ†æ•°éƒ½è¦>=68
        return HOLD
    
    return BUY
```

**é¢„æœŸæ•ˆæœï¼š**
- äº¤æ˜“æ¬¡æ•°ä»29æ¬¡é™è‡³8-12æ¬¡
- èƒœç‡ä»40%æå‡è‡³55-65%
- å‡å°‘å‡çªç ´æŸå¤±

---

### æ–¹å‘2ï¼šç®€åŒ–å–å‡ºé€»è¾‘ï¼ˆPriority: HIGHï¼‰

#### é—®é¢˜æ ¹æº
å½“å‰3ä¸ªExitç­–ç•¥éƒ½æœ‰é—®é¢˜ï¼š
- ATRï¼šæœºæ¢°æ­¢æŸï¼Œä¸è€ƒè™‘å¸‚åœºç¯å¢ƒ
- ScoreBasedï¼šè¿‡åº¦ä¾èµ–åˆ†æ•°ï¼Œå¿½ç•¥æç«¯äº‹ä»¶
- Layeredï¼šå¤ªå¤æ‚ï¼Œä¼˜å…ˆçº§æ··ä¹±

#### æ”¹è¿›æ–¹æ¡ˆï¼šä¸¤é˜¶æ®µé€€å‡º
```python
class ImprovedExitStrategy:
    """
    é˜¶æ®µ1ï¼šç´§æ€¥é€€å‡ºï¼ˆç³»ç»Ÿæ€§é£é™©ï¼‰
    é˜¶æ®µ2ï¼šæ­£å¸¸é€€å‡ºï¼ˆè¶‹åŠ¿ç»ˆç»“ï¼‰
    """
    
    def generate_exit_signal(self, data, date, position):
        # === é˜¶æ®µ1ï¼šç´§æ€¥é€€å‡ºï¼ˆæ— æ¡ä»¶å–å‡ºï¼‰===
        emergency = self._check_emergency(data, date)
        if emergency:
            return SELL(reason=emergency, priority="EMERGENCY")
        
        # === é˜¶æ®µ2ï¼šæ­£å¸¸é€€å‡ºï¼ˆéœ€ç¡®è®¤ï¼‰===
        exit_reasons = []
        
        # é€€å‡ºç†ç”±1ï¼šæœºæ„èµ„é‡‘åè½¬
        inst_score = calculate_institutional_score(data, date)
        if inst_score < 40 and inst_score < position.entry_inst_score - 30:
            exit_reasons.append("INST_EXODUS")
        
        # é€€å‡ºç†ç”±2ï¼šåˆ†æ•°æŒç»­èµ°ä½
        score = calculate_composite_score(data, date)
        if score < 55 and score < position.entry_score - 15:
            exit_reasons.append("SCORE_DECAY")
        
        # é€€å‡ºç†ç”±3ï¼šè¶‹åŠ¿ç ´å
        if self._trend_broken(data, date):
            exit_reasons.append("TREND_BREAK")
        
        # é€€å‡ºç†ç”±4ï¼šæ­¢ç›ˆä¿æŠ¤ï¼ˆé”å®šåˆ©æ¶¦ï¼‰
        profit_pct = (data.loc[date, 'close'] - position.entry_price) / position.entry_price
        if profit_pct > 0.20:  # ç›ˆåˆ©20%ä»¥ä¸Š
            # ä½¿ç”¨å®½æ¾trailing stop
            if self._trailing_stop_hit(data, date, atr_multiple=3.0):
                exit_reasons.append("PROFIT_PROTECT")
        
        # éœ€è¦è‡³å°‘2ä¸ªé€€å‡ºç†ç”±æ‰å–å‡ºï¼ˆé¿å…è¿‡åº¦æ•æ„Ÿï¼‰
        if len(exit_reasons) >= 2:
            return SELL(reason=exit_reasons, priority="NORMAL")
        
        return HOLD
    
    def _check_emergency(self, data, date):
        """ç´§æ€¥æƒ…å†µï¼šå¤–èµ„è¿ç»­å¤§å¹…æµå‡º"""
        frgn_bal = data['frgnbal'].tail(10)  # è¿‘10å¤©
        if (frgn_bal < -1e12).sum() >= 7:  # 10å¤©å†…7å¤©æµå‡ºè¶…1ä¸‡äº¿æ—¥å…ƒ
            return "FOREIGN_EXODUS_EXTREME"
        
        # å¯ä»¥å¢åŠ å…¶ä»–ç³»ç»Ÿæ€§é£é™©æŒ‡æ ‡
        return None
```

**æ ¸å¿ƒæ”¹è¿›ç‚¹ï¼š**
1. **æ˜ç¡®ä¼˜å…ˆçº§**ï¼šEmergency > Normal
2. **å¤šé‡ç¡®è®¤**ï¼šæ­£å¸¸é€€å‡ºéœ€è¦2ä¸ªä»¥ä¸Šç†ç”±
3. **æœºæ„èµ„é‡‘ä¼˜å…ˆ**ï¼šå¤–èµ„æµå‘æ˜¯æœ€é‡è¦leading indicator
4. **ç›ˆåˆ©ä¿æŠ¤**ï¼šå¤§å¹…ç›ˆåˆ©åæ‰ç”¨trailing stopï¼ˆé¿å…å°ç›ˆåˆ©è¢«éœ‡å‡ºï¼‰

---

### æ–¹å‘3ï¼šå¢åŠ å¸‚åœºç¯å¢ƒè¿‡æ»¤ï¼ˆPriority: MEDIUMï¼‰

#### é—®é¢˜æ ¹æº
- 2022å¹´ç†Šå¸‚å…¨äºï¼ˆä¿„ä¹Œæˆ˜äº‰ã€ç¾è”å‚¨åŠ æ¯ï¼‰
- ç­–ç•¥æ²¡æœ‰è¯†åˆ«"å¤§ç¯å¢ƒæ¶åŠ£ï¼Œåº”è¯¥ç©ºä»“"çš„èƒ½åŠ›

#### æ”¹è¿›æ–¹æ¡ˆï¼šå¸‚åœºçŠ¶æ€æœº
```python
class MarketRegimeFilter:
    """å¸‚åœºç¯å¢ƒè¿‡æ»¤å™¨"""
    
    def get_market_regime(self, benchmark_data, date):
        """
        è¿”å›å¸‚åœºçŠ¶æ€ï¼šBULL / NEUTRAL / BEAR
        """
        topix = benchmark_data.loc[:date, 'close']
        
        # æŒ‡æ ‡1ï¼šè¶‹åŠ¿æ–¹å‘
        ema50 = topix.rolling(50).mean().iloc[-1]
        ema200 = topix.rolling(200).mean().iloc[-1]
        
        # æŒ‡æ ‡2ï¼šåŠ¨é‡
        returns_3m = (topix.iloc[-1] / topix.iloc[-63] - 1)  # 3ä¸ªæœˆæ¶¨è·Œå¹…
        
        # æŒ‡æ ‡3ï¼šæ³¢åŠ¨ç‡
        volatility = topix.pct_change().rolling(20).std().iloc[-1]
        
        # ç»¼åˆåˆ¤æ–­
        if ema50 > ema200 and returns_3m > 0.05 and volatility < 0.02:
            return "BULL"  # ç‰›å¸‚ï¼šå¯ä»¥æ¿€è¿›
        elif ema50 < ema200 and returns_3m < -0.05:
            return "BEAR"  # ç†Šå¸‚ï¼šç©ºä»“æˆ–æåº¦ä¿å®ˆ
        else:
            return "NEUTRAL"  # éœ‡è¡ï¼šæ­£å¸¸ç­–ç•¥

# åº”ç”¨åˆ°Entry Strategy
def generate_entry_signal_with_regime(data, date, benchmark):
    regime = MarketRegimeFilter().get_market_regime(benchmark, date)
    
    if regime == "BEAR":
        return HOLD  # ç†Šå¸‚ä¸ä¹°
    
    score = calculate_composite_score(data, date)
    
    if regime == "BULL":
        threshold = 65  # ç‰›å¸‚å¯ä»¥é™ä½é˜ˆå€¼
    else:
        threshold = 72  # éœ‡è¡å¸‚æé«˜é˜ˆå€¼
    
    return BUY if score >= threshold else HOLD
```

**é¢„æœŸæ•ˆæœï¼š**
- 2022å¹´ç†Šå¸‚é¿å¼€å¤§éƒ¨åˆ†æŸå¤±
- 2023-2024ç‰›å¸‚æé«˜æŒä»“ç‡
- æ•´ä½“Alphaæ”¹å–„15-25%

---

### æ–¹å‘4ï¼šä¼˜åŒ–ä»“ä½ç®¡ç†ï¼ˆPriority: MEDIUMï¼‰

#### é—®é¢˜æ ¹æº
- å½“å‰ç­–ç•¥ï¼šè¦ä¹ˆæ»¡ä»“ï¼Œè¦ä¹ˆç©ºä»“ï¼ˆ0/1äºŒå…ƒï¼‰
- å¯¼è‡´æŒä»“ç‡ä½ï¼ˆå¹³å‡60-70%ï¼‰ï¼Œè¸ç©ºç‰›å¸‚

#### æ”¹è¿›æ–¹æ¡ˆï¼šåŠ¨æ€ä»“ä½
```python
class PositionSizer:
    """ä»“ä½ç®¡ç†å™¨"""
    
    def calculate_position_size(self, signal, market_regime, capital):
        """
        æ ¹æ®ä¿¡å·å¼ºåº¦å’Œå¸‚åœºç¯å¢ƒå†³å®šä»“ä½
        """
        if signal.action != BUY:
            return 0
        
        # åŸºç¡€ä»“ä½ï¼šæ ¹æ®ä¿¡å·å¼ºåº¦
        base_position = self._score_to_position(signal.score)
        # score 70-75: 60%ä»“ä½
        # score 75-80: 80%ä»“ä½
        # score 80+:   95%ä»“ä½
        
        # è°ƒæ•´ç³»æ•°ï¼šæ ¹æ®å¸‚åœºç¯å¢ƒ
        regime_multiplier = {
            "BULL": 1.2,      # ç‰›å¸‚åŠ ä»“
            "NEUTRAL": 1.0,   # æ­£å¸¸
            "BEAR": 0.5       # ç†Šå¸‚å‡ä»“
        }[market_regime]
        
        # æœ€ç»ˆä»“ä½
        final_position = min(base_position * regime_multiplier, 0.95)
        
        return capital * final_position
```

**é¢„æœŸæ•ˆæœï¼š**
- æé«˜å¹³å‡æŒä»“ç‡è‡³80-90%
- å‡å°‘è¸ç©ºæŸå¤±
- Alphaæ”¹å–„10-15%

---

### æ–¹å‘5ï¼šå¢åŠ æ­¢ç›ˆç­–ç•¥ï¼ˆPriority: LOWï¼‰

#### é—®é¢˜æ ¹æº
å½“å‰åªæœ‰æ­¢æŸï¼Œæ²¡æœ‰æ­¢ç›ˆ
- EnhancedScorer + ScoreBasedExitæŒæœ‰309å¤©æ¶¨25%å°±æ»¡è¶³äº†
- å®é™…TOPIXåŒæœŸæ¶¨äº†æ›´å¤šï¼ˆ40%+ï¼‰

#### æ”¹è¿›æ–¹æ¡ˆï¼šåˆ†æ‰¹æ­¢ç›ˆ
```python
def partial_profit_taking(position, current_price, date):
    """
    åˆ†æ‰¹æ­¢ç›ˆï¼šé”å®šåˆ©æ¶¦ï¼Œè®©å‰©ä½™ä»“ä½è·‘
    """
    profit_pct = (current_price - position.entry_price) / position.entry_price
    
    if profit_pct > 0.30:  # ç›ˆåˆ©30%
        # å–å‡º50%ä»“ä½ï¼Œé”å®šåˆ©æ¶¦
        return PARTIAL_SELL(ratio=0.5, reason="PROFIT_30PCT")
    
    elif profit_pct > 0.50:  # ç›ˆåˆ©50%
        # å†å–å‡º30%ä»“ä½ï¼ˆå‰©ä½™20%è®©å®ƒè·‘ï¼‰
        return PARTIAL_SELL(ratio=0.3, reason="PROFIT_50PCT")
    
    return HOLD
```

---

## ğŸ“‹ æ”¹è¿›ä¼˜å…ˆçº§æ€»ç»“

### ç«‹å³æ‰§è¡Œï¼ˆHIGH Priorityï¼‰
1. âœ… **æé«˜ä¹°å…¥é˜ˆå€¼è‡³70**ï¼ˆä»65ï¼‰
2. âœ… **å¢åŠ æœºæ„èµ„é‡‘ç¡®è®¤**ï¼ˆinst_score >= 60ï¼‰
3. âœ… **ä¹°å…¥ä¿¡å·3å¤©ç¡®è®¤**ï¼ˆé¿å…å‡çªç ´ï¼‰
4. âœ… **ç®€åŒ–Exitä¸ºä¸¤é˜¶æ®µ**ï¼ˆEmergency + NormalåŒç¡®è®¤ï¼‰

### ä¸­æœŸä¼˜åŒ–ï¼ˆMEDIUM Priorityï¼‰
5. âš ï¸ **å¢åŠ å¸‚åœºç¯å¢ƒè¿‡æ»¤å™¨**ï¼ˆè¯†åˆ«ç‰›/ç†Šå¸‚ï¼‰
6. âš ï¸ **åŠ¨æ€ä»“ä½ç®¡ç†**ï¼ˆæé«˜æŒä»“ç‡ï¼‰
7. âš ï¸ **æœºæ„èµ„é‡‘ä¼˜å…ˆçº§æå‡**ï¼ˆä½œä¸ºæ ¸å¿ƒleading indicatorï¼‰

### é•¿æœŸç ”ç©¶ï¼ˆLOW Priorityï¼‰
8. ğŸ’¡ **åˆ†æ‰¹æ­¢ç›ˆæœºåˆ¶**
9. ğŸ’¡ **äº¤æ˜“æˆæœ¬ç²¾ç¡®è®¡ç®—**
10. ğŸ’¡ **å¤šè‚¡ç¥¨ç»„åˆæµ‹è¯•**ï¼ˆåˆ†æ•£é£é™©ï¼‰

---

## ğŸ”¬ éªŒè¯è®¡åˆ’

### é˜¶æ®µ1ï¼šå¿«é€ŸéªŒè¯ï¼ˆ1-2å¤©ï¼‰
- ä¿®æ”¹Entryé˜ˆå€¼70ï¼Œå¢åŠ 3å¤©ç¡®è®¤
- ç®€åŒ–Exitä¸ºåŒé˜¶æ®µé€»è¾‘
- **ç›®æ ‡ï¼šèƒœç‡æå‡è‡³50%+ï¼Œäº¤æ˜“æ¬¡æ•°é™è‡³10æ¬¡ä»¥å†…**

### é˜¶æ®µ2ï¼šç³»ç»Ÿæ€§æ”¹è¿›ï¼ˆ3-5å¤©ï¼‰
- å¢åŠ å¸‚åœºç¯å¢ƒè¿‡æ»¤
- å®ç°åŠ¨æ€ä»“ä½
- **ç›®æ ‡ï¼šAlphaæ”¹å–„è‡³-20%ä»¥å†…ï¼ˆvs TOPIXï¼‰**

### é˜¶æ®µ3ï¼šæ·±åº¦ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
- æœºæ„èµ„é‡‘æƒé‡ä¼˜åŒ–
- å‚æ•°ç½‘æ ¼æœç´¢
- å¤šè‚¡ç¥¨éªŒè¯
- **ç›®æ ‡ï¼šæ‰¾åˆ°1-2ä¸ªå¯ä»¥è·‘èµ¢TOPIXçš„ç»„åˆ**

---

## ğŸ“ å…³é”®å­¦ä¹ 

### ä»å¤±è´¥ä¸­å­¦åˆ°çš„
1. **æ‹©æ—¶ä¸å¦‚é€‰è‚¡** - å†å¥½çš„ç­–ç•¥ä¹Ÿæ— æ³•å¼¥è¡¥é€‰é”™è‚¡ç¥¨
2. **æŒä»“æ¯”æ‹©æ—¶é‡è¦** - ç©ºä»“=100%è¸ç©º
3. **æœºæ„èµ„é‡‘æ˜¯king** - æŠ€æœ¯æŒ‡æ ‡æ˜¯lagï¼Œèµ„é‡‘æµå‘æ˜¯lead
4. **ç®€å•>å¤æ‚** - Layered 15å±‚é€»è¾‘åè€Œä¸å¦‚ç®€å•çš„2é˜¶æ®µ
5. **å¸‚åœºç¯å¢ƒ>ä¸ªè‚¡ä¿¡å·** - ç†Šå¸‚é‡Œç¥ä»™ä¹Ÿäºé’±

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
ğŸ¯ **å…ˆä¼˜åŒ–ä¹°å…¥è´¨é‡ï¼ˆHigh Priority 1-4ï¼‰â†’ å¿«é€Ÿå›æµ‹éªŒè¯ â†’ å†åšä¸­é•¿æœŸä¼˜åŒ–**
